function c(e,r,t){try{e==="extension"?chrome.runtime.sendMessage(r).then(n=>{t&&t(n)}).catch(n=>{console.error("Error sending message to extension:",n)}):typeof e=="number"&&chrome.tabs.sendMessage(e,r).then(n=>{t&&t(n)}).catch(n=>{console.error("Error sending message to tab:",e,n)})}catch(n){console.error("Exception in sendMessageSafely:",n)}}var o="";chrome.runtime.onMessage.addListener((e,r,t)=>(e.action==="textSelected"?(o=e.text,c("extension",{action:"updateSelectedText",text:e.text,insertImmediately:e.insertImmediately||!1}),t({success:!0})):e.action==="contentScriptLoaded"?t({acknowledged:!0}):e.action==="getLastSelectedText"?t({text:o}):e.action==="testConnection"&&t({success:!0,message:"Background script is connected",lastSelectedText:o||"No text selected yet"}),!0));try{chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"sendToAI",title:"Send to AI Assistant",contexts:["selection"]})}),chrome.contextMenus.onClicked.addListener((e,r)=>{e.menuItemId==="sendToAI"&&e.selectionText&&(o=e.selectionText,c("extension",{action:"updateSelectedText",text:e.selectionText,insertImmediately:!0}),r?.id&&c(r.id,{action:"selectionCaptured"}))})}catch(e){console.error("Error setting up context menu:",e)}try{chrome.commands.onCommand.addListener(e=>{e==="capture_selection"&&chrome.tabs.query({active:!0,currentWindow:!0},r=>{let t=r[0]?.id;t&&c(t,{action:"captureSelection"})})})}catch(e){console.error("Error setting up command listener:",e)}function s(e){return!!(e&&(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("file://"))&&!e.startsWith("https://chrome.google.com/")&&!e.startsWith("chrome://")&&!e.startsWith("chrome-extension://"))}chrome.runtime.onInstalled.addListener(()=>{try{chrome.tabs.query({},e=>{for(let r of e){let t=r.id;if(t&&s(r.url))try{chrome.scripting.executeScript({target:{tabId:t},files:["content.js"]}).catch(n=>{console.warn("Failed to execute content script on install:",n)})}catch(n){console.error("Error executing script on install:",n)}}})}catch(e){console.error("Error in onInstalled listener:",e)}});try{chrome.tabs.onUpdated.addListener((e,r,t)=>{r.status==="complete"&&s(t.url)&&chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]}).catch(n=>{console.warn("Failed to inject content script on update:",n)})})}catch(e){console.error("Error in tabs.onUpdated listener:",e)}try{chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>{console.warn("Failed to set side panel behavior:",e)})}catch(e){console.error("Error setting up side panel behavior:",e)}
